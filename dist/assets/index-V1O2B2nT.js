import{s as Y}from"./request-C0k_ht0T.js";import{r as i,H as J,I as Z,o as O,e as u,f as k,g,i as l,p as M,k as t,J as ee,q as H,h as P,b as le,F as U,B as F,m as h,t as te,K,L as T,M as ae}from"./tailwind-HU2q0cE2.js";import{c as oe,u as ne,b as ue,p as se,d as re,o as ie}from"./index-DreuhGQT.js";import"./index-loe9NHZV.js";const de={class:"app-table"},ce={key:0,ref:"pagination"},pe={key:1,class:"table-mask"},me={name:"app-table"},Q=Object.assign(me,{props:{url:String,maxHeight:String,lazy:{type:Boolean,default:!1},queryParams:{type:Function,default(){return()=>{}}},methods:{type:String,default:"Get"},pagination:{type:Boolean,default:!0},data:{type:Array,default:()=>[]},stripe:{type:Boolean,default:!1},border:{type:Boolean,default:!1},emptyText:String,pageSize:{type:Number,default:10},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},ifUseLoading:{type:Boolean,default:!0},showPagination:{type:Boolean,default:!0}},emits:["current-change-page","current-change-size","selection-change"],setup(C,{expose:L,emit:m}){const n=C,V=i(!1),o=i(0),_=i(1),y=i(n.pageSize),f=i([]),S=i([]),I=i(!1),w=J(()=>n.url!==void 0),N=J(()=>n.pageSize===10?[10,20,30,40,50,100]:[n.pageSize,10,20,30,40,50,100].sort((e,c)=>e-c)),s=m,v=e=>{y.value=e,x(1),s("current-change-size",e)},x=e=>{if(w.value)_.value=e,r();else{let c=[];for(let p=0;p<y.value;p++){let d=S.value[(e-1)*y.value+p];d&&c.push(d)}o.value=S.value.length,f.value=c}s("current-change-page",e)},z=e=>{s("selection-change",e)},$=(e=!1)=>{w.value&&(e&&(_.value=1,s("current-change-page",1)),r())},r=e=>{let c=Object.assign(n.showPagination?{pageNum:_.value,pageSize:y.value}:{},n.queryParams());V.value=n.ifUseLoading,Y({method:n.methods,url:n.url,params:c}).then(p=>{Array.isArray(p.rows)&&p.rows.length?(f.value=p.rows,o.value=p.total||o.value,o.value&&!f.value.length&&$(!0)):(f.value=[],o.value=0),I.value=!0}).finally(()=>{V.value=!1})};return Z(()=>n.data,e=>{f.value=e}),O(()=>{n.pagination?w.value?!n.lazy&&r():(S.value=n.data,I.value=!0,x(1)):f.value=S.value=n.data}),L({reload:$}),(e,c)=>{const p=u("el-table"),d=u("el-pagination");return g(),k("div",de,[l(p,{style:{width:"100%"},data:f.value,stripe:C.stripe,border:C.border,"empty-text":C.emptyText,"max-height":C.maxHeight,onSelectionChange:z},{default:t(()=>[ee(e.$slots,"default")]),_:3},8,["data","stripe","border","empty-text","max-height"]),C.pagination&&C.showPagination?(g(),k("div",ce,[I.value&&o.value>0?(g(),H(d,{key:0,onSizeChange:v,onCurrentChange:x,"current-page":_.value,"page-size":y.value,"page-sizes":N.value,total:o.value,layout:C.layout,class:"flex justify-end pt-4",size:"small"},null,8,["current-page","page-size","page-sizes","total","layout"])):M("",!0)],512)):M("",!0),V.value?(g(),k("div",pe,c[0]||(c[0]=[P("div",{class:"el-loading-spinner"},[P("svg",{viewBox:"25 25 50 50",class:"circular"},[P("circle",{cx:"50",cy:"50",r:"20",fill:"none",class:"path"})])],-1)]))):M("",!0)])}}}),ge=["src","onClick"],fe={class:"w-full text-right"},ve={__name:"category",setup(C){const L=K(),m=i(!1),n=i({categoryId:"",logo:""}),V=i([]),o=i([]),_=s=>{s&&L.appContext.config.globalProperties.$hevueImgPreview(s)},y=s=>{n.value.logo=s.raw},f=()=>{n.value.logo=""},S=s=>{n.value={categoryId:s.id,logo:s.logo},V.value=[{name:s.logo,url:s.logo}],m.value=!0},I=s=>{_(s.url)},w=()=>{n.value={categoryId:"",logo:""},m.value=!1},N=()=>{if(!n.value.logo)return T.warning("请上传Logo图片"),!1;ne(n.value).then(()=>{T.success("修改成功"),w()})};return O(()=>{oe().then(s=>{o.value=s.data})}),(s,v)=>{const x=u("el-descriptions-item"),z=u("el-button"),$=u("el-descriptions"),r=u("el-table-column"),e=u("Plus"),c=u("el-icon"),p=u("el-upload"),d=u("el-form-item"),R=u("el-form"),q=u("el-dialog");return g(),k(U,null,[l(Q,{data:o.value,pagination:!1},{default:t(()=>[l(r,{type:"expand"},{default:t(({row:b})=>[l($,{column:3,border:""},{default:t(()=>[(g(!0),k(U,null,F(b.child,D=>(g(),k(U,null,[l(x,{label:"名称"},{default:t(()=>[h(te(D.name),1)]),_:2},1024),l(x,{label:"Logo"},{default:t(()=>[P("img",{src:D.logo,alt:"",onClick:E=>_(D.logo),loading:"lazy",width:"30"},null,8,ge)]),_:2},1024),l(x,{label:"操作"},{default:t(()=>[l(z,{link:"",type:"primary",onClick:E=>S(D)},{default:t(()=>v[1]||(v[1]=[h("编辑")])),_:2},1032,["onClick"])]),_:2},1024)],64))),256))]),_:2},1024)]),_:1}),l(r,{label:"名称",prop:"name"})]),_:1},8,["data"]),l(q,{modelValue:m.value,"onUpdate:modelValue":v[0]||(v[0]=b=>m.value=b),"close-on-press-escape":!1,"close-on-click-modal":!1,title:"更新Logo"},{default:t(()=>[l(R,null,{default:t(()=>[l(d,{label:"Logo"},{default:t(()=>[l(p,{action:"#",multiple:"","on-change":y,"on-remove":f,"file-list":V.value,"on-preview":I,"list-type":"picture-card","auto-upload":!1,limit:1},{default:t(()=>[l(c,null,{default:t(()=>[l(e)]),_:1})]),_:1},8,["file-list"])]),_:1}),l(d,null,{default:t(()=>[P("div",fe,[l(z,{onClick:w},{default:t(()=>v[2]||(v[2]=[h("取消")])),_:1}),l(z,{type:"primary",onClick:N},{default:t(()=>v[3]||(v[3]=[h("确定")])),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},_e=le(ve,[["__scopeId","data-v-d08a9d72"]]),ye={class:"bg-white p-4 m-4"},be=["src","onClick"],he={class:"flex flex-wrap"},ke=["src","onClick"],Ce={class:"w-full text-right"},Se={__name:"index",setup(C){const L=i("product"),m=i({keyword:"",categoryId:""}),n=i(!1),V=i(null),o=i({title:"",imgsSrc:[],markCode:"",categoryId:"",purchase:0,listPrice:0,sellingPrice:0}),_=i(null),y=i([]),f=i([]),S=K(),I=()=>{const{keyword:r,categoryId:e}=m.value;return{keyword:r,categoryId:e}},w=()=>{V.value.reload(!0)},N=()=>{m.value={keyword:"",categoryId:""},w()},s=r=>{se(r.goodsId).then(e=>{o.value=e.data,f.value=e.data.imgsSrc.map(c=>({name:c,url:c}))}),n.value=!0},v=r=>{ae.confirm("确定删除吗？","提示",{type:"warning"}).then(()=>{re(r.goodsId).then(()=>{T.success("删除成功"),V.value.reload(!1)})}).catch(()=>{})},x=()=>{o.value.goodsId="",f.value=[],_.value.resetFields(),n.value=!1},z=()=>{_.value.validate(r=>{r&&(o.value.imgsSrc=f.value.map(e=>e.url||e.raw),ie(o.value).then(()=>{T.success("编辑成功"),x(),w()}))})},$=r=>{S.appContext.config.globalProperties.$hevueImgPreview(r)};return O(()=>{ue().then(r=>{y.value=r.data})}),(r,e)=>{const c=u("el-option"),p=u("el-select"),d=u("el-form-item"),R=u("el-col"),q=u("el-input"),b=u("el-button"),D=u("el-row"),E=u("el-form"),B=u("el-table-column"),G=u("el-tab-pane"),W=u("el-tabs"),j=u("el-input-number"),X=u("el-dialog");return g(),k(U,null,[P("section",ye,[l(W,{class:"mb-2",type:"card",modelValue:L.value,"onUpdate:modelValue":e[3]||(e[3]=a=>L.value=a)},{default:t(()=>[l(G,{label:"商品列表",name:"product"},{default:t(()=>[l(E,{model:m.value},{default:t(()=>[l(D,{gutter:32},{default:t(()=>[l(R,{span:8},{default:t(()=>[l(d,{label:"商品分类",prop:"categoryId"},{default:t(()=>[l(p,{modelValue:m.value.categoryId,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value.categoryId=a),filterable:""},{default:t(()=>[(g(!0),k(U,null,F(y.value,a=>(g(),H(c,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(R,{span:8},{default:t(()=>[l(d,{label:"关键词",prop:"keyword"},{default:t(()=>[l(q,{modelValue:m.value.keyword,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value.keyword=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(R,{span:8},{default:t(()=>[l(b,{onClick:N},{default:t(()=>e[11]||(e[11]=[h("重置")])),_:1}),l(b,{type:"primary",onClick:w},{default:t(()=>e[12]||(e[12]=[h("查询")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),l(b,{class:"mb-4",onClick:e[2]||(e[2]=a=>n.value=!0),type:"primary"},{default:t(()=>e[13]||(e[13]=[h("新增")])),_:1}),l(Q,{ref_key:"tableRef",ref:V,url:"/sys/product/item/list","query-params":I},{default:t(()=>[l(B,{label:"标题",prop:"title","min-width":"300"}),l(B,{label:"封面",prop:"imgSrc"},{default:t(({row:a})=>[P("img",{class:"cursor-pointer",src:a.imgSrc,alt:"",width:"40",onClick:A=>$(a.imgSrc)},null,8,be)]),_:1}),l(B,{label:"商品分类",prop:"categoryName"}),l(B,{label:"进货价",prop:"purchase"}),l(B,{label:"标价",prop:"listPrice"}),l(B,{label:"售价",prop:"sellingPrice"}),l(B,{label:"操作",width:"120"},{default:t(({row:a})=>[l(b,{link:"",type:"primary",onClick:A=>s(a)},{default:t(()=>e[14]||(e[14]=[h("编辑")])),_:2},1032,["onClick"]),l(b,{link:"",type:"primary",onClick:A=>v(a)},{default:t(()=>e[15]||(e[15]=[h("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},512)]),_:1}),l(G,{label:"商品分类",name:"category"},{default:t(()=>[l(_e)]),_:1})]),_:1},8,["modelValue"])]),l(X,{modelValue:n.value,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value=a),"close-on-click-modal":!1,"close-on-press-escape":!1,title:"编辑"},{default:t(()=>[l(E,{ref_key:"formRef",ref:_,model:o.value,"label-width":"auto"},{default:t(()=>[l(d,{label:"标题",prop:"title"},{default:t(()=>[l(q,{modelValue:o.value.title,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.title=a),type:"text",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(d,{label:"详情图",prop:"imgsSrc"},{default:t(()=>[P("div",he,[(g(!0),k(U,null,F(o.value.imgsSrc,a=>(g(),k("img",{class:"rounded-s w-1/3 border-box p-1 cursor-pointer",src:a,key:a,alt:"",onClick:A=>$(a)},null,8,ke))),128))])]),_:1}),l(d,{label:"搜索码",prop:"markCode"},{default:t(()=>[l(q,{modelValue:o.value.markCode,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.markCode=a),type:"text",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(d,{label:"商品分类",prop:"categoryId"},{default:t(()=>[l(p,{modelValue:o.value.categoryId,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.categoryId=a),filterable:""},{default:t(()=>[(g(!0),k(U,null,F(y.value,a=>(g(),H(c,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"进货价",prop:"purchase"},{default:t(()=>[l(j,{modelValue:o.value.purchase,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.purchase=a),precision:2},null,8,["modelValue"])]),_:1}),l(d,{label:"标价",prop:"listPrice"},{default:t(()=>[l(j,{modelValue:o.value.listPrice,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.listPrice=a),precision:2},null,8,["modelValue"])]),_:1}),l(d,{label:"售价",prop:"sellingPrice"},{default:t(()=>[l(j,{modelValue:o.value.sellingPrice,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.sellingPrice=a),precision:2},null,8,["modelValue"])]),_:1}),l(d,null,{default:t(()=>[P("div",Ce,[l(b,{onClick:x},{default:t(()=>e[16]||(e[16]=[h("取消")])),_:1}),l(b,{onClick:z,type:"primary"},{default:t(()=>e[17]||(e[17]=[h("确定")])),_:1})])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}};export{Se as default};
